## å®éªŒç›®çš„

1. äº†è§£é˜¿é‡Œäº‘ RDSï¼ˆ_Relational Database Service_ï¼‰ã€‚
2. ç†Ÿç»ƒä½¿ç”¨ MySQL æ•°æ®åº“æ“ä½œå‘½ä»¤ã€‚
3. ç†Ÿæ‚‰è¿æ¥ RDS for MySQL æ•°æ®åº“çš„æ–¹æ³•ã€‚

## å®éªŒè¦æ±‚

### 1. é˜¿é‡Œäº‘ RDS å®ä¾‹å‡†å¤‡

â‘  æ–°ç”¨æˆ·å¯ä»¥ä½¿ç”¨å…è´¹ä½“éªŒ RDS æœåŠ¡ï¼Œå¹¶åœ¨å®ä¾‹ä¸Šæ–°å»º RDS æ•°æ®åº“ _mysql_ã€‚  
â‘¡ è´­ä¹° RDS å®ä¾‹ï¼Œå¹¶è¿›è¡Œç®¡ç†ã€‚  
â‘¢ åœ¨è¯¥å®ä¾‹ä¸Šæ–°å»ºæ•°æ®åº“ _mysql_ã€‚

### 2. MySQL æ•°æ®åº“æ“ä½œ

â‘  ä½¿ç”¨ä»»æ„æ–¹å¼è¿æ¥ MySQL æ•°æ®åº“ã€‚  
â‘¡ åœ¨ _mysql_ æ•°æ®åº“ä¸­æ–°å»ºè¡¨ _user_ï¼ŒåŒ…å« 4 åˆ—ï¼š`id`ï¼ˆä¸»é”®ï¼‰ã€`name`ã€`age`ã€`sex`ã€‚  
â‘¢ å¯¹ _user_ è¡¨è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚

### 3. MySQL æ•°æ®è¿ç§»è‡³ RDS

â‘  åœ¨æœ¬åœ°æ–°å»º MySQL æ•°æ®åº“ã€‚  
â‘¡ åœ¨æœ¬åœ°æ•°æ®åº“ _mysql_ ä¸­åˆ›å»ºä¸€ä¸ªè¿ç§»è´¦å·ã€‚  
â‘¢ è®¾ç½®è¿ç§»è´¦å·çš„æƒé™ã€‚  
â‘£ ä¿®æ”¹æœ¬åœ° MySQL é…ç½®æ–‡ä»¶ã€‚  
â‘¤ ç¡®è®¤æœ¬åœ°æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ä¸º **ROW**ã€‚  
â‘¥ å°†æ•°æ®è¿ç§»è‡³ RDSã€‚

### 4. åº”ç”¨ç¨‹åºä½¿ç”¨ RDS æ•°æ®åº“

â‘  åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªç®€å•åº”ç”¨ç¨‹åºï¼Œç¨‹åºéœ€ä½¿ç”¨ RDS æ•°æ®åº“ä¸­çš„ _user_ è¡¨çš„æ•°æ®ã€‚  
â‘¡ é…ç½®è¯¥ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

## ä»»åŠ¡ä¸€

â‘  æ–°ç”¨æˆ·å¯ä»¥ä½¿ç”¨å…è´¹ä½“éªŒ RDS æœåŠ¡ï¼Œå¹¶åœ¨å®ä¾‹ä¸Šæ–°å»º RDS æ•°æ®åº“ _mysql_ã€‚  
â‘¡ è´­ä¹° RDS å®ä¾‹ï¼Œå¹¶è¿›è¡Œç®¡ç†ã€‚  
â‘¢ åœ¨è¯¥å®ä¾‹ä¸Šæ–°å»ºæ•°æ®åº“ _mysql_ã€‚

[freeRDS](../other/freeRDS.md)
> å®éªŒè¦æ±‚åˆ›å»º mysqlï¼Œä½† DATABASE mysql æ˜¯é¢„è£…å°±æœ‰çš„ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸€ä¸ªåå­—ã€‚
## ä»»åŠ¡äºŒ

â‘  ä½¿ç”¨ä»»æ„æ–¹å¼è¿æ¥ MySQL æ•°æ®åº“ã€‚  
â‘¡ åœ¨ _mysql_ æ•°æ®åº“ä¸­æ–°å»ºè¡¨ _user_ï¼ŒåŒ…å« 4 åˆ—ï¼š`id`ï¼ˆä¸»é”®ï¼‰ã€`name`ã€`age`ã€`sex`ã€‚  
â‘¢ å¯¹ _user_ è¡¨è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚

é€šè¿‡ç”³è¯·å…¬ç½‘åœ°å€è¿æ¥æ•°æ®åº“

- è¿æ¥å‘½ä»¤
    

```
mariadb -h æ•°æ®åº“åœ°å€ -P 3306 -u ç”¨æˆ·å -p --ssl=0
```

![](assets/2025-11-11-1.png)

- æŸ¥çœ‹ mydb æ•°æ®åº“æ˜¯å¦å­˜åœ¨
    

```sql
SHOW DATABASES;

# ä»»åŠ¡ä¸€ä¸­å·²ç»åˆ›å»ºï¼Œæˆ–ç°åœ¨åˆ›å»ºä¸€ä¸ª
CREATE DATABASE mydb;
```

![](assets/2025-11-11-3.png)

> å®éªŒè¦æ±‚åˆ›å»º mysqlï¼Œä½† DATABASE mysql æ˜¯é¢„è£…å°±æœ‰çš„ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸€ä¸ªåå­—ã€‚

- åˆ›å»º user è¡¨
    

```sql
CREATE TABLE user (
	id INT PRIMARY KEY,
	name VARCHAR(50),
	age INT,
	sex ENUM('M','F')
);
```

![](assets/2025-11-11-4.png)

- æ’å…¥æ•°æ®
    

```sql
INSERT INTO user (id, name, age, sex)
VALUES (1, 'Alice', 23, 'F');

INSERT INTO user (id, name, age, sex)
VALUES (2, 'Box', 25, 'M');
```

![](assets/2025-11-11-5.png)

- æŸ¥è¯¢æ•°æ®
    

```sql
SELECT * FROM user;
```

![](assets/2025-11-11-6.png)

- æ›´æ–°æ•°æ®
    

```sql
UPDATE user SET age=26
WHERE id=2;

# æ£€éªŒä¿®æ”¹æ˜¯å¦æˆåŠŸ
SELECT * FROM user;
```

![](assets/2025-11-11-7.png)

- åˆ é™¤æ•°æ®
    

```sql
DELETE FROM user
WHERE id=1;

# æ£€éªŒåˆ é™¤æ˜¯å¦æˆåŠŸ
SELECT * FROM user;
```

![](assets/2025-11-11-8.png)

## ä»»åŠ¡ä¸‰
â‘  åœ¨æœ¬åœ°æ–°å»º MySQL æ•°æ®åº“ã€‚  
â‘¡ åœ¨æœ¬åœ°æ•°æ®åº“ _mysql_ ä¸­åˆ›å»ºä¸€ä¸ªè¿ç§»è´¦å·ã€‚  
â‘¢ è®¾ç½®è¿ç§»è´¦å·çš„æƒé™ã€‚  
â‘£ ä¿®æ”¹æœ¬åœ° MySQL é…ç½®æ–‡ä»¶ã€‚  
â‘¤ ç¡®è®¤æœ¬åœ°æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ä¸º **ROW**ã€‚  
â‘¥ å°†æ•°æ®è¿ç§»è‡³ RDSã€‚

- ç™»å½•æœ¬åœ° MySQL
    

```bash
mariadb -u root -p
```

Ubuntu 20.04æˆ–æ›´æ—©

```bash
mysql -u root -p
```

![](assets/2025-11-11-9.png)

- åˆ›å»º mydb æ•°æ®åº“å¹¶æ–°å»º user è¡¨ï¼Œæ’å…¥ç¤ºä¾‹æ•°æ®
    

```sql
INSERT INTO user (id, name, age, sex) VALUES (1, 'Alice', 22, 'F');
INSERT INTO user (id, name, age, sex) VALUES (2, 'Bob', 25, 'M');
INSERT INTO user (id, name, age, sex) VALUES (3, 'Cha', 23, 'F');
INSERT INTO user (id, name, age, sex) VALUES (4, 'Dia', 21, 'F');
INSERT INTO user (id, name, age, sex) VALUES (5, 'Eve', 23, 'F');
```

![](assets/2025-11-11-10.png)

- åˆ›å»ºè¿ç§»è´¦å·
    

```sql
CREATE USER 'ç”¨æˆ·å'@'%' IDENTIFIED BY 'å¯†ç ';
```

![](assets/2025-11-11-11.png)

- æˆæƒè¿ç§»è´¦å·
    

```sql
GRANT ALL PRIVILEGES ON mydb.* TO 'ç”¨æˆ·å'@'%';
FLUSH PRIVILEGES;
```

![](assets/2025-11-11-12.png)

- ç¼–è¾‘ /etc/my.cnf.d/server.cnf
    

```cnf
[mysql]
log-bin = mysql-bin
binlog_format = ROW
server-id = 1
```

![](assets/2025-11-11-13.png)

- é‡æ–°å¯åŠ¨ MariaDB æœåŠ¡
    

```bash
sudo systemctl restart mariadb.service
```

- æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
    

```bash
mariadb -u ç”¨æˆ·å -på¯†ç  -e "SHOW VARIABLES LIKE 'binlog_format';"
```

![](assets/2025-11-11-14.png)

- å¯¼å‡ºæœ¬åœ°æ•°æ®åº“
    

```bash
mysqldump -u ç”¨æˆ·å -på¯†ç  --databases mydb --routines --triggers --single-transaction --master-data=2 > æ–‡ä»¶å.sql
```

![](assets/2025-11-11-15.png)  
![](assets/2025-11-11-17.png)

- å¯¼å…¥åˆ° RDS
    

```bash
mariadb -h RDSåœ°å€ -P 3306 -u ç”¨æˆ·å -p --ssl=0 < å¤‡ä»½çš„sqlæ–‡ä»¶
```

![](assets/2025-11-11-18.png)

- è¿æ¥ RDS å¹¶æŸ¥è¯¢
    

```bash
mariadb -h RDSåœ°å€ -P 3306 -u ç”¨æˆ·å -p --ssl=0
```

```sql
USE mydb;
SELECT * FROM user;
```

![](assets/2025-11-11-20.png)

> æ•°æ®ä¸æœ¬åœ° user è¡¨ç›¸ç¬¦ï¼Œå¯¼å…¥æˆåŠŸ ğŸ¥³

## ä»»åŠ¡å››
â‘  åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªç®€å•åº”ç”¨ç¨‹åºï¼Œç¨‹åºéœ€ä½¿ç”¨ RDS æ•°æ®åº“ä¸­çš„ _user_ è¡¨çš„æ•°æ®ã€‚  
â‘¡ é…ç½®è¯¥ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

> æœ¬é¡¹ç›®å®ä¾‹ä½¿ç”¨ *Rust + React* æ„å»º 
1. ç®€å•æ„å»ºäº†ä¸€ä¸ªå›¾ç‰‡å­˜å‚¨é¡¹ç›®, é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
photo-wall
â”œâ”€â”€ backend
â”‚Â Â  â”œâ”€â”€ Cargo.toml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â”œâ”€â”€ db.rs
â”‚Â Â      â”œâ”€â”€ handlers.rs
â”‚Â Â      â”œâ”€â”€ main.rs
â”‚Â Â      â””â”€â”€ models.rs
â”œâ”€â”€ frontend
â”‚Â Â  â”œâ”€â”€ eslint.config.js
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ public
â”‚Â Â  â”‚Â Â  â””â”€â”€ vite.svg
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ App.css
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ App.jsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ react.svg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.css
â”‚Â Â  â”‚Â Â  â””â”€â”€ main.jsx
â”‚Â Â  â””â”€â”€ vite.config.js
â”œâ”€â”€ package.json
â””â”€â”€ uploads
```

é€šè¿‡åœ¨.env ä¸­æ˜æ–‡å­˜æ”¾äº† RDS çš„è´¦å·å¯†ç è¿æ¥æ•°æ®åº“
**cat photo-wall/backend/.env**
```env
DATABASE_URL=mysql://ç”¨æˆ·å:(æ•°æ®åº“å¯†ç )@rm-cn-fsw4igyvf0002a2o.rwlb.rds.al
iyuncs.com:3306/photo_wall
SERVER_HOST=127.0.0.1
SERVER_PORT=8080
UPLOAD_DIR=ç»å¯¹è·¯å¾„/photo-wall/uploads
```

æ•ˆæœï¼š
![](assets/2025-11-11-21.png)
![](assets/2025-11-11-22.png)

æ·»åŠ /åˆ é™¤ç…§ç‰‡æ—¶ï¼ŒRDS ä¼šåŒæ­¥æ›´æ–°ï¼š
![](assets/2025-11-11-23.png)

### å…³é”®ä»£ç 

#### â‘  åˆ›å»ºæ•°æ®åº“è¿æ¥æ±  `create_pool`

```rust
pub async fn create_pool(database_url: &str) -> Result<MySqlPool, sqlx::Error> {
    MySqlPoolOptions::new()
        .max_connections(5)
        .connect(database_url)
        .await
}
```

**ä½œç”¨**

- å»ºç«‹ MySQL æ•°æ®åº“è¿æ¥æ± ï¼ˆ`MySqlPool`ï¼‰
    
- é¿å…æ¯æ¬¡æŸ¥è¯¢éƒ½æ–°å»ºè¿æ¥ï¼Œæé«˜æ€§èƒ½
    

---

#### â‘¡ æŸ¥è¯¢æ‰€æœ‰ç…§ç‰‡ `get_all_photos`

```rust
pub async fn get_all_photos(pool: &MySqlPool) -> Result<Vec<Photo>, sqlx::Error> {
    sqlx::query_as::<_, Photo>("SELECT * FROM photos ORDER BY upload_time DESC")
        .fetch_all(pool)
        .await
}
```

**ä½œç”¨**

- æŸ¥è¯¢æ•°æ®åº“ä¸­æ‰€æœ‰ç…§ç‰‡è®°å½•
    
- æŒ‰ `upload_time` å€’åºæ’åºï¼ˆæœ€æ–°ä¸Šä¼ çš„åœ¨å‰ï¼‰
    
- `query_as::<_, Photo>` å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°è‡ªå®šä¹‰ç»“æ„ä½“ `Photo`
    

---

#### â‘¢ åˆ›å»ºæ–°ç…§ç‰‡ `create_photo`

```rust
pub async fn create_photo(
    pool: &MySqlPool,
    filename: &str,
    title: &str,
    description: Option<&str>,
) -> Result<Photo, sqlx::Error> {
    // æ’å…¥æ–°ç…§ç‰‡è®°å½•
    sqlx::query("INSERT INTO photos (filename, title, description) VALUES (?, ?, ?)")
        .bind(filename)
        .bind(title)
        .bind(description)
        .execute(pool)
        .await?;

    // æŸ¥è¯¢åˆšæ’å…¥çš„è®°å½•å¹¶è¿”å›
    sqlx::query_as::<_, Photo>("SELECT * FROM photos WHERE filename = ? ORDER BY id DESC LIMIT 1")
        .bind(filename)
        .fetch_one(pool)
        .await
}
```

**ä½œç”¨**

- æ’å…¥æ–°ç…§ç‰‡è®°å½•
    
- é€šè¿‡ `filename` æŸ¥è¯¢åˆšæ’å…¥çš„è®°å½•å¹¶è¿”å› `Photo`
    
- ä½¿ç”¨ `?` å ä½ç¬¦é˜²æ­¢ SQL æ³¨å…¥ï¼Œ`.bind()` å¯¹åº”å ä½ç¬¦ä¼ å‚
    
- `ORDER BY id DESC LIMIT 1` ç¡®ä¿å–åˆ°æœ€æ–°è®°å½•
    

---

#### â‘£ åˆ é™¤ç…§ç‰‡ `delete_photo`

```rust
pub async fn delete_photo(pool: &MySqlPool, id: i32) -> Result<String, sqlx::Error> {
    // æŸ¥è¯¢è¦åˆ é™¤çš„ç…§ç‰‡ä¿¡æ¯
    let photo = sqlx::query_as::<_, Photo>("SELECT * FROM photos WHERE id = ?")
        .bind(id)
        .fetch_one(pool)
        .await?;

    // æ‰§è¡Œåˆ é™¤æ“ä½œ
    sqlx::query("DELETE FROM photos WHERE id = ?")
        .bind(id)
        .execute(pool)
        .await?;

    // è¿”å›è¢«åˆ é™¤ç…§ç‰‡çš„ filename
    Ok(photo.filename)
}
```

**ä½œç”¨**

- å…ˆæŸ¥è¯¢å†åˆ é™¤ï¼Œä»¥è·å–è¢«åˆ é™¤ç…§ç‰‡ä¿¡æ¯
    
- å¦‚æœè®°å½•ä¸å­˜åœ¨ï¼Œ`fetch_one` ä¼šæŠ¥é”™
    
- è¿”å›è¢«åˆ é™¤ç…§ç‰‡çš„ `filename`
    
